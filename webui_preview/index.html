<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>VL53L1x Configuration</title><style>* { box-sizing: border-box; }body { padding: 0; margin: 0; background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }.navbar { background-color: #212529; padding: 15px 0; margin-bottom: 20px; }.navbar-nav { display: flex; flex-direction: row; list-style: none; margin: 0; padding: 0 20px; justify-content: flex-start; align-items: center; width: 100%; }.navbar-nav li { margin: 0 15px; }.navbar-nav a { color: #ffffff; text-decoration: none; font-weight: 500; padding: 8px 16px; border-radius: 4px; transition: background-color 0.2s; }.navbar-nav a:hover { background-color: rgba(255, 255, 255, 0.1); }.navbar-nav a.active { background-color: #007bff; }.navbar-nav li.sensor-nav-item { display: none; }.content-wrapper { padding: 20px; }.container { max-width: 800px; background: white; padding: 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 0 auto; overflow: hidden; }.page-header { background-color: #f8f9fa; padding: 20px 30px; border-bottom: 1px solid #dee2e6; }.page-header h1 { margin: 0; color: #212529; font-size: 1.75rem; font-weight: 700; text-transform: uppercase; }.page-content { padding: 30px; }.row { display: flex; flex-wrap: wrap; margin: 0 -10px; }.col-md-6 { flex: 0 0 50%; max-width: 50%; padding: 0 10px; }.col-md-4 { flex: 0 0 33.333333%; max-width: 33.333333%; padding: 0 10px; }@media (max-width: 768px) { .col-md-6, .col-md-4 { flex: 0 0 100%; max-width: 100%; } }.form-group { margin-bottom: 20px; }label { font-weight: 600; color: #555; display: block; margin-bottom: 5px; }.form-control { display: block; width: 100%; padding: 8px 12px; font-size: 14px; line-height: 1.5; color: #495057; background-color: #fff; border: 1px solid #ced4da; border-radius: 4px; }.form-control:focus { border-color: #80bdff; outline: 0; box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25); }.btn { display: inline-block; padding: 8px 16px; font-size: 14px; font-weight: 400; text-align: center; cursor: pointer; border: 1px solid transparent; border-radius: 4px; text-decoration: none; }.btn-primary { color: #fff; background-color: #007bff; border-color: #007bff; }.btn-primary:hover { background-color: #0069d9; border-color: #0062cc; }.btn-secondary { color: #fff; background-color: #6c757d; border-color: #6c757d; }.btn-secondary:hover { background-color: #5a6268; border-color: #545b62; }.btn-warning { color: #212529; background-color: #ffc107; border-color: #ffc107; }.btn-warning:hover { background-color: #e0a800; border-color: #d39e00; }.alert { position: relative; padding: 12px 20px; margin-bottom: 20px; border: 1px solid transparent; border-radius: 4px; }.alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }.alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }.alert-warning { color: #856404; background-color: #fff3cd; border-color: #ffeaa7; }.alert-info { color: #0c5460; background-color: #d1ecf1; border-color: #bee5eb; }.input-group { display: flex; align-items: stretch; }.input-group .form-control { flex: 1 1 auto; }.input-group .btn { margin-left: 5px; }.btn-group { margin-top: 30px; }.status-card { border: 1px solid #ddd; border-radius: 8px; padding: 0; margin-bottom: 20px; background-color: #fff; overflow: hidden; }.card-header { background-color: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #dee2e6; margin: 0; }.card-header h2 { margin: 0; color: #212529; font-size: 1.25rem; font-weight: 600; }.card-body { padding: 20px; }</style></head><body><nav class="navbar"><ul class="navbar-nav"><li><a href="index.html" class="active">Configuration</a></li><li class="sensor-nav-item"><a href="status.html">VL53L1x</a></li><li><a href="inputassembly.html">T->O</a></li><li><a href="outputassembly.html">O->T</a></li><li><a href="ota.html">Firmware Update</a></li></ul></nav><div class="content-wrapper"><div class="container"><div class="page-header"><h1>Configuration</h1></div><div class="page-content"><div class="status-card" style="margin-bottom: 30px;"><div class="card-header"><h2>Network Configuration</h2></div><div class="card-body"><form id="ipconfigForm"><div class="form-group"><label style="display: flex; align-items: center; cursor: pointer;"><input type="checkbox" id="use_dhcp" name="use_dhcp" style="margin-right: 8px; width: auto; cursor: pointer;"><span>Use DHCP (Automatic IP Assignment)</span></label></div><div style="margin-bottom: 20px; padding: 12px; background-color: #f8f9fa; border-left: 4px solid #007bff; border-radius: 4px;"><p style="margin: 0; color: #495057; font-size: 14px; line-height: 1.6;"><strong>Network Settings:</strong> Configure the device's IP address and network parameters. These settings are stored in OpENer's NVS and control both EtherNet/IP and Modbus TCP connectivity. When DHCP is enabled, the device automatically obtains network settings from your router. For static IP configuration, ensure the IP address, netmask, and gateway are compatible with your network. A device reboot is required for network changes to take effect.</p></div><div id="staticIpFields" style="display: none;"><div class="row"><div class="col-md-4"><div class="form-group"><label>IP Address</label><input type="text" class="form-control" id="ip_address" name="ip_address" placeholder="192.168.1.100" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$"></div></div><div class="col-md-4"><div class="form-group"><label>Netmask</label><input type="text" class="form-control" id="netmask" name="netmask" placeholder="255.255.255.0" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$"></div></div><div class="col-md-4"><div class="form-group"><label>Gateway</label><input type="text" class="form-control" id="gateway" name="gateway" placeholder="192.168.1.1" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$"></div></div></div></div><div id="dnsFields" style="display: none;"><div class="row"><div class="col-md-6"><div class="form-group"><label>Primary DNS</label><input type="text" class="form-control" id="dns1" name="dns1" placeholder="8.8.8.8" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$"></div></div><div class="col-md-6"><div class="form-group"><label>Secondary DNS</label><input type="text" class="form-control" id="dns2" name="dns2" placeholder="8.8.4.4" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$"></div></div></div></div><button type="button" class="btn btn-primary" onclick="saveIpConfig()">Save Network Configuration</button><span style="margin-left: 10px; color: #666; font-size: 12px;">(Reboot required to apply changes)</span></form></div></div><div class="status-card" style="margin-top: 30px;"><div class="card-header"><h2>Modbus TCP</h2></div><div class="card-body"><form id="modbusForm"><div class="form-group"><label style="display: flex; align-items: center; cursor: pointer;"><input type="checkbox" id="modbus_enabled" name="modbus_enabled" style="margin-right: 8px; width: auto; cursor: pointer;"><span>Enable Modbus TCP Server (Port 502)</span></label></div><div style="margin-top: 15px; margin-bottom: 15px; padding: 12px; background-color: #f8f9fa; border-left: 4px solid #007bff; border-radius: 4px;"><p style="margin: 0; color: #495057; font-size: 14px; line-height: 1.6;"><strong>Data Mapping:</strong> The Modbus TCP server provides read-write access to the same data structures used by EtherNet/IP. Input Registers 0-15 mirror the Input Assembly 100 (sensor readings including distance, status, ambient light, and signal strength), while Holding Registers 100-115 mirror the Output Assembly 150 (32 bytes of control data). All data is synchronized in real-time between Modbus TCP and EtherNet/IP protocols.</p></div><button type="button" class="btn btn-primary" onclick="saveModbusConfig()">Save Modbus Configuration</button></form></div></div><div class="status-card" style="margin-top: 30px;"><div class="card-header"><h2>VL53L1x Sensor Configuration</h2></div><div class="card-body"><form id="sensorConfigForm"><div class="form-group"><label style="display: flex; align-items: center; cursor: pointer;"><input type="checkbox" id="sensor_enabled" name="sensor_enabled" style="margin-right: 8px; width: auto; cursor: pointer;"><span>Enable VL53L1x Sensor</span></label></div><div style="margin-top: 15px; margin-bottom: 15px; padding: 12px; background-color: #f8f9fa; border-left: 4px solid #007bff; border-radius: 4px;"><p style="margin: 0; color: #495057; font-size: 14px; line-height: 1.6;"><strong>Time-of-Flight Sensor:</strong> The VL53L1x is a high-precision distance measurement sensor using time-of-flight technology. Configure measurement parameters such as distance mode (SHORT for <1.3m, LONG for <4m), timing budget, and region of interest (ROI). Calibration values (offset and crosstalk) improve accuracy for your specific application. All settings are saved to NVS and persist across reboots. Changes take effect immediately after saving.</p></div><div class="form-group" style="margin-top: 20px;"><label>Sensor Data Byte Range</label><select class="form-control" id="sensor_byte_range" name="sensor_byte_range"><option value="0">Bytes 0-8</option><option value="9">Bytes 9-17</option><option value="18">Bytes 18-26</option></select><small style="display: block; margin-top: 5px; color: #6c757d;">Select the byte range in Input Assembly 100 where sensor data will be written (9 bytes total)</small></div><button type="button" class="btn btn-primary" onclick="saveSensorConfig()">Save Sensor Configuration</button><div id="sensorSettingsFields"><div style="margin-top: 30px; padding-bottom: 15px; margin-bottom: 20px; border-bottom: 2px solid #dee2e6;"><h3 style="margin: 0; color: #212529; font-size: 1.25rem; font-weight: 600;">Sensor Measurement Settings</h3></div><form id="configForm"><div class="row"><div class="col-md-6"><div class="form-group"><label>Distance Mode</label><select class="form-control" id="distance_mode" name="distance_mode"><option value="1">SHORT (<1.3m)</option><option value="2">LONG (<4m)</option></select></div></div><div class="col-md-6"><div class="form-group"><label>Timing Budget (ms)</label><select class="form-control" id="timing_budget_ms" name="timing_budget_ms"><option value="15">15</option><option value="20">20</option><option value="33">33</option><option value="50">50</option><option value="100">100</option><option value="200">200</option><option value="500">500</option></select></div></div></div><div class="form-group"><label>Inter-Measurement Period (ms)</label><input type="number" class="form-control" id="inter_measurement_ms" name="inter_measurement_ms" min="15" step="1"></div><div class="row"><div class="col-md-4"><div class="form-group"><label>ROI X Size</label><input type="number" class="form-control" id="roi_x_size" name="roi_x_size" min="4" max="16" value="16"></div></div><div class="col-md-4"><div class="form-group"><label>ROI Y Size</label><input type="number" class="form-control" id="roi_y_size" name="roi_y_size" min="4" max="16" value="16"></div></div><div class="col-md-4"><div class="form-group"><label>ROI Center SPAD</label><input type="number" class="form-control" id="roi_center_spad" name="roi_center_spad" min="0" max="199" value="199"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Offset (mm)</label><div class="input-group"><input type="number" class="form-control" id="offset_mm" name="offset_mm" min="-128" max="127" value="0"><button type="button" class="btn btn-secondary" onclick="calibrateOffset()">Calibrate</button></div></div></div><div class="col-md-6"><div class="form-group"><label>Xtalk (cps)</label><div class="input-group"><input type="number" class="form-control" id="xtalk_cps" name="xtalk_cps" min="0" max="65535" value="0"><button type="button" class="btn btn-secondary" onclick="calibrateXtalk()">Calibrate</button></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Signal Threshold (kcps)</label><input type="number" class="form-control" id="signal_threshold_kcps" name="signal_threshold_kcps" min="0" max="65535" value="1024"></div></div><div class="col-md-6"><div class="form-group"><label>Sigma Threshold (mm)</label><input type="number" class="form-control" id="sigma_threshold_mm" name="sigma_threshold_mm" min="0" max="65535" value="15"></div></div></div><div class="row"><div class="col-md-4"><div class="form-group"><label>Threshold Low (mm)</label><input type="number" class="form-control" id="threshold_low_mm" name="threshold_low_mm" min="0" max="4000" value="0"></div></div><div class="col-md-4"><div class="form-group"><label>Threshold High (mm)</label><input type="number" class="form-control" id="threshold_high_mm" name="threshold_high_mm" min="0" max="4000" value="0"></div></div><div class="col-md-4"><div class="form-group"><label>Threshold Window</label><select class="form-control" id="threshold_window" name="threshold_window"><option value="0">Below</option><option value="1">Above</option><option value="2">Out</option><option value="3">In</option></select></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Interrupt Polarity</label><select class="form-control" id="interrupt_polarity" name="interrupt_polarity"><option value="0">Active Low</option><option value="1">Active High</option></select></div></div><div class="col-md-6"><div class="form-group"><label>I2C Address</label><input type="text" class="form-control" id="i2c_address" name="i2c_address" pattern="0x[0-9A-Fa-f]{2}" value="0x29"></div></div></div><div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #dee2e6;"><div style="display: flex; justify-content: space-between; gap: 15px;"><button type="button" class="btn btn-primary" onclick="saveConfig()" style="flex: 1;">Save Measurement Settings</button><button type="button" class="btn btn-secondary" onclick="loadConfig()" style="flex: 1;">Load Current Settings</button><button type="button" class="btn btn-warning" onclick="resetConfig()" style="flex: 1;">Reset to Defaults</button></div></div></form></div><div id="message" class="alert" style="display:none; margin-top:20px;"></div></form></div></div><script>function showMessage(text, type) {  const msg = document.getElementById('message');  msg.textContent = text;  msg.className = 'alert alert-' + type;  msg.style.display = 'block';  setTimeout(() => msg.style.display = 'none', 5000);}function loadIpConfig() {  fetch('/api/ipconfig')    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      var dhcpCheckbox = document.getElementById('use_dhcp');      var staticFields = document.getElementById('staticIpFields');      var dnsFields = document.getElementById('dnsFields');      if (dhcpCheckbox && data.use_dhcp !== undefined) dhcpCheckbox.checked = data.use_dhcp;      if (staticFields && data.use_dhcp !== undefined) staticFields.style.display = data.use_dhcp ? 'none' : 'block';      if (dnsFields && data.use_dhcp !== undefined) dnsFields.style.display = data.use_dhcp ? 'none' : 'block';      var ipAddr = document.getElementById('ip_address');      var netmask = document.getElementById('netmask');      var gateway = document.getElementById('gateway');      var dns1 = document.getElementById('dns1');      var dns2 = document.getElementById('dns2');      if (ipAddr) ipAddr.value = (data.ip_address && data.ip_address !== '0.0.0.0') ? data.ip_address : '';      if (netmask) netmask.value = (data.netmask && data.netmask !== '0.0.0.0') ? data.netmask : '';      if (gateway) gateway.value = (data.gateway && data.gateway !== '0.0.0.0') ? data.gateway : '';      if (dns1) dns1.value = (data.dns1 && data.dns1 !== '0.0.0.0') ? data.dns1 : '';      if (dns2) dns2.value = (data.dns2 && data.dns2 !== '0.0.0.0') ? data.dns2 : '';    })    .catch(err => {      console.error('Failed to load IP configuration:', err);    });}function saveIpConfig() {  const data = {    use_dhcp: document.getElementById('use_dhcp').checked,    ip_address: document.getElementById('ip_address').value,    netmask: document.getElementById('netmask').value,    gateway: document.getElementById('gateway').value,    dns1: document.getElementById('dns1').value,    dns2: document.getElementById('dns2').value  };  fetch('/api/ipconfig', {    method: 'POST',    headers: { 'Content-Type': 'application/json' },    body: JSON.stringify(data)  })    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      if (data.status === 'ok') {        showMessage(data.message, 'success');      } else {        showMessage('Failed to save IP configuration', 'danger');      }    })    .catch(err => {      console.error('Failed to save IP configuration:', err);      showMessage('Failed to save IP configuration', 'danger');    });}function loadModbusConfig() {  fetch('/api/modbus')    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      if (data.enabled !== undefined) document.getElementById('modbus_enabled').checked = data.enabled;    })    .catch(err => {      console.error('Failed to load Modbus configuration:', err);    });}function saveModbusConfig() {  const data = {    enabled: document.getElementById('modbus_enabled').checked  };  fetch('/api/modbus', {    method: 'POST',    headers: { 'Content-Type': 'application/json' },    body: JSON.stringify(data)  })    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      if (data.status === 'ok') {        showMessage(data.message, 'success');      } else {        showMessage('Failed to save Modbus configuration', 'danger');      }    })    .catch(err => {      console.error('Failed to save Modbus configuration:', err);      showMessage('Failed to save Modbus configuration', 'danger');    });}function loadSensorConfig() {  Promise.all([    fetch('/api/sensor/enabled').then(r => r.json()),    fetch('/api/sensor/byteoffset').then(r => r.json())  ])    .then(([enabledData, byteOffsetData]) => {      const sensorEnabled = document.getElementById('sensor_enabled');      const sensorFields = document.getElementById('sensorSettingsFields');      const byteRangeSelect = document.getElementById('sensor_byte_range');      if (sensorEnabled && enabledData.enabled !== undefined) {        sensorEnabled.checked = enabledData.enabled;        if (sensorFields) {          sensorFields.style.display = enabledData.enabled ? 'block' : 'none';        }      }      if (byteRangeSelect && byteOffsetData.start_byte !== undefined) {        byteRangeSelect.value = byteOffsetData.start_byte.toString();      }    })    .catch(err => {      console.error('Failed to load sensor configuration:', err);    });}function saveSensorConfig() {  const enabled = document.getElementById('sensor_enabled').checked;  const byteRangeSelect = document.getElementById('sensor_byte_range');  const startByte = byteRangeSelect ? parseInt(byteRangeSelect.value) : 0;  Promise.all([    fetch('/api/sensor/enabled', {      method: 'POST',      headers: { 'Content-Type': 'application/json' },      body: JSON.stringify({ enabled: enabled })    }).then(r => r.json()),    fetch('/api/sensor/byteoffset', {      method: 'POST',      headers: { 'Content-Type': 'application/json' },      body: JSON.stringify({ start_byte: startByte })    }).then(r => r.json())  ])    .then(([enabledResult, byteOffsetResult]) => {      if (enabledResult.status === 'ok' && byteOffsetResult.status === 'ok') {        showMessage('Sensor configuration saved successfully', 'success');        const sensorFields = document.getElementById('sensorSettingsFields');        if (sensorFields) {          sensorFields.style.display = enabled ? 'block' : 'none';        }        updateNavigationBar();      } else {        showMessage('Failed to save sensor configuration', 'danger');      }    })    .catch(err => {      console.error('Failed to save sensor configuration:', err);      showMessage('Failed to save sensor configuration', 'danger');    });}function updateNavigationBar() {  fetch('/api/sensor/enabled')    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      const navItems = document.querySelectorAll('nav li.sensor-nav-item');      navItems.forEach(item => {        if (item) {          item.style.display = data.enabled ? 'block' : 'none';        }      });    })    .catch(err => {      console.error('Failed to update navigation bar:', err);    });}function loadConfig() {  fetch('/api/config')    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      if (data.distance_mode !== undefined && data.distance_mode !== null) document.getElementById('distance_mode').value = data.distance_mode;      if (data.timing_budget_ms !== undefined && data.timing_budget_ms !== null) document.getElementById('timing_budget_ms').value = data.timing_budget_ms;      if (data.inter_measurement_ms !== undefined && data.inter_measurement_ms !== null) document.getElementById('inter_measurement_ms').value = data.inter_measurement_ms;      if (data.roi_x_size !== undefined && data.roi_x_size !== null) document.getElementById('roi_x_size').value = data.roi_x_size;      if (data.roi_y_size !== undefined && data.roi_y_size !== null) document.getElementById('roi_y_size').value = data.roi_y_size;      if (data.roi_center_spad !== undefined && data.roi_center_spad !== null) document.getElementById('roi_center_spad').value = data.roi_center_spad;      if (data.offset_mm !== undefined && data.offset_mm !== null) document.getElementById('offset_mm').value = data.offset_mm;      if (data.xtalk_cps !== undefined && data.xtalk_cps !== null) document.getElementById('xtalk_cps').value = data.xtalk_cps;      if (data.signal_threshold_kcps !== undefined && data.signal_threshold_kcps !== null) document.getElementById('signal_threshold_kcps').value = data.signal_threshold_kcps;      if (data.sigma_threshold_mm !== undefined && data.sigma_threshold_mm !== null) document.getElementById('sigma_threshold_mm').value = data.sigma_threshold_mm;      if (data.threshold_low_mm !== undefined && data.threshold_low_mm !== null) document.getElementById('threshold_low_mm').value = data.threshold_low_mm;      if (data.threshold_high_mm !== undefined && data.threshold_high_mm !== null) document.getElementById('threshold_high_mm').value = data.threshold_high_mm;      if (data.threshold_window !== undefined && data.threshold_window !== null) document.getElementById('threshold_window').value = data.threshold_window;      if (data.interrupt_polarity !== undefined && data.interrupt_polarity !== null) document.getElementById('interrupt_polarity').value = data.interrupt_polarity;      if (data.i2c_address !== undefined && data.i2c_address !== null) document.getElementById('i2c_address').value = '0x' + data.i2c_address.toString(16).padStart(2, '0');      showMessage('Configuration loaded', 'success');    })    .catch(err => {      console.error('Failed to load configuration:', err);      showMessage('Failed to load configuration', 'danger');    });}function saveConfig() {  const addr = document.getElementById('i2c_address').value;  const addrNum = parseInt(addr, 16);  const data = {    distance_mode: parseInt(document.getElementById('distance_mode').value),    timing_budget_ms: parseInt(document.getElementById('timing_budget_ms').value),    inter_measurement_ms: parseInt(document.getElementById('inter_measurement_ms').value),    roi_x_size: parseInt(document.getElementById('roi_x_size').value),    roi_y_size: parseInt(document.getElementById('roi_y_size').value),    roi_center_spad: parseInt(document.getElementById('roi_center_spad').value),    offset_mm: parseInt(document.getElementById('offset_mm').value),    xtalk_cps: parseInt(document.getElementById('xtalk_cps').value),    signal_threshold_kcps: parseInt(document.getElementById('signal_threshold_kcps').value),    sigma_threshold_mm: parseInt(document.getElementById('sigma_threshold_mm').value),    threshold_low_mm: parseInt(document.getElementById('threshold_low_mm').value),    threshold_high_mm: parseInt(document.getElementById('threshold_high_mm').value),    threshold_window: parseInt(document.getElementById('threshold_window').value),    interrupt_polarity: parseInt(document.getElementById('interrupt_polarity').value),    i2c_address: addrNum  };  fetch('/api/config', {    method: 'POST',    headers: { 'Content-Type': 'application/json' },    body: JSON.stringify(data)  })    .then(r => {      if (!r.ok) throw new Error('HTTP ' + r.status);      return r.json();    })    .then(data => {      if (data.status === 'ok') {        showMessage('Configuration saved successfully', 'success');      } else {        showMessage('Failed to save configuration', 'danger');      }    })    .catch(err => {      console.error('Failed to save configuration:', err);      showMessage('Failed to save configuration', 'danger');    });}function resetConfig() {  if (confirm('Reset to default configuration?')) {    document.getElementById('distance_mode').value = 2;    document.getElementById('timing_budget_ms').value = 100;    document.getElementById('inter_measurement_ms').value = 100;    document.getElementById('roi_x_size').value = 16;    document.getElementById('roi_y_size').value = 16;    document.getElementById('roi_center_spad').value = 199;    document.getElementById('offset_mm').value = 0;    document.getElementById('xtalk_cps').value = 0;    document.getElementById('signal_threshold_kcps').value = 1024;    document.getElementById('sigma_threshold_mm').value = 15;    document.getElementById('threshold_low_mm').value = 0;    document.getElementById('threshold_high_mm').value = 0;    document.getElementById('threshold_window').value = 0;    document.getElementById('interrupt_polarity').value = 1;    document.getElementById('i2c_address').value = '0x29';    showMessage('Form reset to defaults', 'info');  }}function calibrateOffset() {  const dist = prompt('Enter target distance in mm (recommended: 100mm):', '100');  if (dist) {    fetch('/api/calibrate/offset', {      method: 'POST',      headers: { 'Content-Type': 'application/json' },      body: JSON.stringify({ target_distance_mm: parseInt(dist) })    })      .then(r => {        if (!r.ok) throw new Error('HTTP ' + r.status);        return r.json();      })      .then(data => {        if (data.status === 'ok') {          document.getElementById('offset_mm').value = data.offset_mm;          showMessage('Offset calibration successful: ' + data.offset_mm + ' mm', 'success');        } else {          showMessage('Offset calibration failed', 'danger');        }      })      .catch(err => {        console.error('Offset calibration error:', err);        showMessage('Offset calibration failed', 'danger');      });  }}function calibrateXtalk() {  const dist = prompt('Enter target distance in mm (recommended: 600mm):', '600');  if (dist) {    fetch('/api/calibrate/xtalk', {      method: 'POST',      headers: { 'Content-Type': 'application/json' },      body: JSON.stringify({ target_distance_mm: parseInt(dist) })    })      .then(r => {        if (!r.ok) throw new Error('HTTP ' + r.status);        return r.json();      })      .then(data => {        if (data.status === 'ok') {          document.getElementById('xtalk_cps').value = data.xtalk_cps;          showMessage('Xtalk calibration successful: ' + data.xtalk_cps + ' cps', 'success');        } else {          showMessage('Xtalk calibration failed', 'danger');        }      })      .catch(err => {        console.error('Xtalk calibration error:', err);        showMessage('Xtalk calibration failed', 'danger');      });  }}window.onload = function() {  console.log('Page loaded, initializing configuration...');  try {    loadConfig();    loadIpConfig();    loadModbusConfig();    loadSensorConfig();    updateNavigationBar();    const sensorEnabled = document.getElementById('sensor_enabled');    if (sensorEnabled) {      sensorEnabled.addEventListener('change', function() {        const sensorFields = document.getElementById('sensorSettingsFields');        if (sensorFields) {          sensorFields.style.display = this.checked ? 'block' : 'none';        }      });    }    var dhcpCheckbox = document.getElementById('use_dhcp');    if (dhcpCheckbox) {      dhcpCheckbox.addEventListener('change', function() {        const useDhcp = this.checked;        const staticFields = document.getElementById('staticIpFields');        const dnsFields = document.getElementById('dnsFields');        if (staticFields) {          staticFields.style.display = useDhcp ? 'none' : 'block';        }        if (dnsFields) {          dnsFields.style.display = useDhcp ? 'none' : 'block';        }        if (!useDhcp) {          fetch('/api/ipconfig')            .then(r => {              if (!r.ok) throw new Error('HTTP ' + r.status);              return r.json();            })            .then(data => {              var ipAddr = document.getElementById('ip_address');              var netmask = document.getElementById('netmask');              var gateway = document.getElementById('gateway');              var dns1 = document.getElementById('dns1');              var dns2 = document.getElementById('dns2');              if (ipAddr) ipAddr.value = (data.ip_address && data.ip_address !== '0.0.0.0') ? data.ip_address : '';              if (netmask) netmask.value = (data.netmask && data.netmask !== '0.0.0.0') ? data.netmask : '';              if (gateway) gateway.value = (data.gateway && data.gateway !== '0.0.0.0') ? data.gateway : '';              if (dns1) dns1.value = (data.dns1 && data.dns1 !== '0.0.0.0') ? data.dns1 : '';              if (dns2) dns2.value = (data.dns2 && data.dns2 !== '0.0.0.0') ? data.dns2 : '';            })            .catch(err => {              console.error('Failed to reload IP configuration:', err);            });        }      });    } else {      console.error('DHCP checkbox not found');    }  } catch (err) {    console.error('Error initializing page:', err);  }};</script></div><footer style="text-align: center; padding: 20px 30px; border-top: 1px solid #dee2e6; color: #666; background-color: #f8f9fa;">OpENer Ethernet/IP for ESP32-P4 | Adam G Sweeney 11-15-2025</footer></div></body></html>