<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OTA Update</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { padding: 20px; background-color: #f5f5f5; }
.container { max-width: 600px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
h1 { color: #333; margin-bottom: 30px; }
.progress { margin-top: 20px; height: 30px; }
</style>
</head>
<body>
<div class="container">
<h1>OTA Firmware Update</h1>
<div class="alert alert-info">
<strong>Preview Mode:</strong> This is a preview. File uploads will not work until flashed to the device.
</div>
<div class="form-group">
<label>Upload Firmware File (.bin)</label>
<input type="file" class="form-control" id="firmware_file" accept=".bin">
</div>
<button class="btn btn-primary" onclick="startOTA()">Start Update</button>
<div id="progress" style="display:none; margin-top:20px;">
<div class="progress">
<div class="progress-bar" role="progressbar" id="progress_bar" style="width:0%">0%</div>
</div>
<p id="status_text">Preparing...</p>
</div>
<div id="message" class="alert" style="display:none; margin-top:20px;"></div>
<div class="btn-group" style="margin-top:20px;">
<a href="index.html" class="btn btn-secondary">Back to Config</a>
<a href="status.html" class="btn btn-info">View Status</a>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function showMessage(text, type) {
  const msg = document.getElementById('message');
  msg.textContent = text;
  msg.className = 'alert alert-' + type;
  msg.style.display = 'block';
}

function startOTA() {
  const fileInput = document.getElementById('firmware_file');
  const file = fileInput.files[0];
  if (!file) {
    showMessage('Please select a firmware file', 'warning');
    return;
  }
  
  // Show preview mode message
  showMessage('Preview Mode: File selected (' + file.name + ', ' + (file.size / 1024).toFixed(1) + ' KB). On device, this would upload and update firmware.', 'info');
  
  document.getElementById('progress').style.display = 'block';
  document.getElementById('message').style.display = 'block';
  
  // Simulate OTA progress
  let progress = 0;
  const interval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 100) progress = 100;
    
    document.getElementById('progress_bar').style.width = progress + '%';
    document.getElementById('progress_bar').textContent = Math.floor(progress) + '%';
    
    if (progress < 30) {
      document.getElementById('status_text').textContent = 'Uploading firmware...';
    } else if (progress < 70) {
      document.getElementById('status_text').textContent = 'Writing to flash...';
    } else if (progress < 95) {
      document.getElementById('status_text').textContent = 'Validating firmware...';
    } else {
      document.getElementById('status_text').textContent = 'Update complete. Device will reboot.';
    }
    
    if (progress >= 100) {
      clearInterval(interval);
      showMessage('Preview Mode: Update simulation complete. On device, firmware would be written and device would reboot.', 'success');
    }
  }, 200);
}

function pollOTAStatus() {
  // Not used in preview mode
}
</script>
</body>
</html>

